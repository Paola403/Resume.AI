{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}
<div class="row justify-content-center mt-5">
Â  Â  <div class="col-md-8">
Â  Â  Â  Â  <h1 class="text-center mb-4">ðŸ“„ Resumir PDF com IA (Gemini)</h1>
Â  Â  Â  Â  
Â  Â  Â  Â  <form id="summarize-form" action="{% url 'resumir_pdf' %}" method="post" enctype="multipart/form-data" class="p-4 border rounded shadow-sm">
Â  Â  Â  Â  Â  Â  {% csrf_token %}
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="id_pdf_file" class="form-label">Selecione seu Arquivo PDF:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" name="pdf_file" id="id_pdf_file" class="form-control" accept=".pdf" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-text">Apenas arquivos .pdf sÃ£o aceitos.</div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="language" class="form-label">Idioma do Resumo:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="language" name="language">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PortuguÃªs">PortuguÃªs</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="InglÃªs">InglÃªs</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Espanhol">Espanhol</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary w-100 mt-4" id="submit-btn">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="button-text" class="text-center">Resumir ConteÃºdo</span>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </form>

Â  Â  Â  Â  <hr class="my-4">

        Â  Â  Â  Â  <div id="loading-area" class="alert alert-info d-none text-center">
Â  Â  Â  Â  Â  Â  <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
Â  Â  Â  Â  Â  Â  Processando o PDF e gerando o resumo...
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="error-area" class="alert alert-danger d-none"></div>

Â  Â  Â  Â  <div id="summary-result" class="card mt-4 d-none">
Â  Â  Â  Â  Â  Â  <div class="card-header bg-primary text-white">
Â  Â  Â  Â  Â  Â  Â  Â  <h4>âœ¨ Resumo Gerado</h4>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="summary-text" class="card-text"></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  // --- LÃ³gica JavaScript para RequisiÃ§Ã£o AJAX (Este Ã© o lugar correto) ---
Â  Â  document.getElementById('summarize-form').addEventListener('submit', function(e) {
Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  const form = e.target;
Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  const submitBtn = document.getElementById('submit-btn');
Â  Â  Â  Â  const buttonText = document.getElementById('button-text');
Â  Â  Â  Â  const spinner = document.getElementById('spinner');
Â  Â  Â  Â  
Â  Â  Â  Â  // Resetar e mostrar carregamento
Â  Â  Â  Â  document.getElementById('error-area').classList.add('d-none');
Â  Â  Â  Â  document.getElementById('summary-result').classList.add('d-none');
Â  Â  Â  Â  document.getElementById('loading-area').classList.remove('d-none');
Â  Â  Â  Â  
Â  Â  Â  Â  // Estado de Carregamento
Â  Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  Â  buttonText.textContent = 'Aguarde...';
Â  Â  Â  Â  spinner.classList.remove('d-none');

Â  Â  Â  Â  fetch(form.action, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: formData,
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(response => response.json().then(data => ({ status: response.status, body: data })))
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  document.getElementById('loading-area').classList.add('d-none');

Â  Â  Â  Â  Â  Â  if (res.status === 200) {
Â  Â  Â  Â  Â  Â  Â  Â  // Sucesso
Â  Â  Â  Â  Â  Â  Â  Â  // Formata o texto para quebras de linha (<br><br>)
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('summary-text').innerHTML = res.body.summary.replace(/\n/g, '<br><br>');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('summary-result').classList.remove('d-none');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Erro (400, 500, etc.)
Â  Â  Â  Â  Â  Â  Â  Â  const errorArea = document.getElementById('error-area');
Â  Â  Â  Â  Â  Â  Â  Â  errorArea.textContent = `Erro (${res.status}): ${res.body.error || 'Ocorreu um erro desconhecido.'}`;
Â  Â  Â  Â  Â  Â  Â  Â  errorArea.classList.remove('d-none');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  // Erro de rede ou CORS
Â  Â  Â  Â  Â  Â  document.getElementById('loading-area').classList.add('d-none');
Â  Â  Â  Â  Â  Â  document.getElementById('error-area').textContent = `Erro de ConexÃ£o: ${error}`;
Â  Â  Â  Â  Â  Â  document.getElementById('error-area').classList.remove('d-none');
Â  Â  Â  Â  })
Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  // Finaliza o estado de carregamento
Â  Â  Â  Â  Â  Â  submitBtn.disabled = false;
Â  Â  Â  Â  Â  Â  buttonText.textContent = 'Resumir ConteÃºdo';
Â  Â  Â  Â  Â  Â  spinner.classList.add('d-none');
Â  Â  Â  Â  });
Â  Â  });
</script>
{% endblock content %}